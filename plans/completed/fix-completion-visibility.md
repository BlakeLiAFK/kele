# 修复补全提示不可见

> 创建: 2026-02-07
> 状态: 已完成

## 目标

修复补全候选行颜色太浅、缺少标识导致用户无法看到补全提示的问题

## 问题分析

通过集成测试确认：
1. 补全逻辑触发正确 — completionHint 和 suggestion 都正确设置
2. View 渲染正确 — 提示行出现在第 20/24 行（输入框上方）
3. **根因1**: Foreground("245") 灰色在终端中太暗淡，用户无法注意到
4. **根因2**: 长候选列表导致提示行溢出换行，View 总行数超过终端高度，布局错乱
5. **根因3**: onInputChanged 路径丢弃了 textarea/viewport 的 cmd

## 修复内容

### 1. 提示行样式增强
- 添加背景色 `236`（深灰）让提示行视觉独立
- 前景色从 `245`（浅灰）改为 `117`（亮青色）
- 添加 `[Tab]` 前缀（`214` 金色加粗）明确指示操作方式

### 2. 提示行溢出截断
- 计算可用宽度 = 终端宽度 - 前缀宽度 - padding
- 超出宽度时截断并添加 "..."
- 确保 View 总行数始终等于终端高度

### 3. cmd 合并修复
- `onInputChanged` 路径现在正确合并 `tiCmd`、`vpCmd` 和补全 cmd
- 保证 textarea 光标闪烁和 viewport 滚动不受影响

## 步骤

- [x] 步骤 1: 增强提示行视觉样式
- [x] 步骤 2: 修复提示行溢出截断
- [x] 步骤 3: 修复 cmd 丢失
- [x] 步骤 4: 测试验证（全部 20 个测试通过）

## 文件变更

| 文件 | 操作 | 说明 |
|------|------|------|
| internal/tui/app.go | 修改 | renderCompletionHint 样式增强 + 截断 + cmd 合并 |
| internal/tui/app_test.go | 新建 | 补全集成测试 + View 布局测试 |
