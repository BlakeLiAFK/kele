# Kele 使用指南

## 🚀 快速开始

### 1. 设置 API Key

```bash
# 使用 OpenAI 兼容的 API
export OPENAI_API_BASE="https://api.z.ai/api/coding/paas/v4"
export OPENAI_API_KEY="your-api-key"
```

### 2. 运行程序

```bash
make run
```

## 💬 基础对话

直接输入消息，按 Enter 发送：

```
> 你好，能帮我分析一下当前目录的结构吗？
```

AI 会自动调用工具来执行操作。

## 🛠️ 可用工具

AI 可以使用以下工具：

### bash - 执行命令

```
> 帮我列出所有 Go 文件
```

AI 会执行：`ls -la *.go`

### read - 读取文件

```
> 帮我看看 main.go 的内容
```

AI 会读取并分析文件内容。

### write - 写入文件

```
> 帮我创建一个 hello.txt 文件，内容是 "Hello, World!"
```

AI 会创建文件。

## 📋 Slash 命令

### /help
显示帮助信息

### /clear
清空当前对话历史

### /status
显示系统状态信息

### /save
保存当前会话（自动保存）

### /memory
查看记忆系统状态

### /exit
退出程序（也可以用 Ctrl+C）

## 🎯 使用示例

### 示例 1: 代码分析

```
> 分析一下这个项目的代码结构
```

AI 会：
1. 执行 `ls -la` 查看文件
2. 读取关键文件
3. 给出分析报告

### 示例 2: 文件操作

```
> 帮我在 internal/test 目录下创建一个测试文件
```

AI 会：
1. 创建目录
2. 生成测试代码
3. 写入文件

### 示例 3: 多步骤任务

```
> 帮我做以下事情：
1. 查看当前有哪些 Go 文件
2. 统计总共有多少行代码
3. 生成一个报告
```

AI 会按步骤执行所有操作。

## 🔧 高级功能

### 流式响应

所有 AI 回复都是流式显示，可以看到"打字机"效果。

### 工具调用可视化

当 AI 使用工具时，会显示：

```
🔧 bash:
$ ls -la
total 128
drwxr-xr-x  15 user  staff   480 Feb  6 12:00 .
...
```

### 自动记忆

所有对话会自动保存到：
- `.kele/memory.db` - SQLite 数据库
- `.kele/MEMORY.md` - Markdown 格式记忆
- `.kele/sessions/` - 会话日志

### 上下文管理

AI 会保留最近 20 轮对话作为上下文，确保连贯性。

## 🐛 故障排查

### 问题 1: API 错误

```
错误: API error: 401 Unauthorized
```

**解决**: 检查 `OPENAI_API_KEY` 环境变量是否正确。

### 问题 2: 连接超时

```
错误: dial tcp: i/o timeout
```

**解决**:
1. 检查网络连接
2. 检查 `OPENAI_API_BASE` 地址是否正确

### 问题 3: 工具执行失败

```
🔧 bash:
错误: command not found
```

**解决**: 检查命令是否在系统中可用。

## 💡 最佳实践

### 1. 清晰的指令

❌ 不好：
```
> 帮我做点事
```

✅ 好：
```
> 帮我分析 main.go 文件，找出可能的性能问题
```

### 2. 分步骤执行

复杂任务可以分步骤：

```
> 第一步：列出所有 .go 文件
```

等待完成后：

```
> 第二步：统计每个文件的行数
```

### 3. 利用上下文

AI 会记住之前的对话：

```
> 读取 config.yaml 文件

> 帮我修改端口为 8080（AI 知道是哪个文件）
```

### 4. 使用命令管理会话

定期使用 `/clear` 清空无关历史，保持上下文清晰。

## 🔒 安全注意事项

### 危险命令保护

以下命令会被自动拦截：
- `rm -rf`
- `dd if=`
- `mkfs`
- `> /dev/`

### 文件权限

AI 只能：
- ✅ 读取当前目录及子目录的文件
- ✅ 在当前目录创建/修改文件
- ❌ 访问系统关键目录

### 数据隐私

所有数据存储在本地：
- `.kele/` 目录
- 不会上传到云端（除了 API 调用）

## 📊 性能指标

- **启动时间**: < 500ms
- **响应延迟**: 取决于 API（通常 1-3s）
- **内存占用**: ~20MB
- **磁盘占用**: 数据库 < 10MB

## 🔄 更新与维护

### 查看版本

```bash
./bin/kele --version  # (待实现)
```

### 清理数据

```bash
rm -rf .kele/
```

这会删除所有本地数据。

### 备份会话

```bash
cp -r .kele/ .kele.backup/
```

## 🆘 获取帮助

1. 程序内帮助：输入 `/help`
2. 查看文档：`docs/README.md`
3. 提交 Issue：GitHub Issues

## 🎉 下一步

- 探索更多工具能力
- 尝试复杂的多步骤任务
- 自定义配置（`.kele/config.yaml`）

享受与 AI 的协作！
